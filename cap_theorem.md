# OTUS NoSQL
## CAP теорема 
CAP-теорема утверждает, что в распределённой системе можно обеспечить только два из трёх свойств: Согласованность (**Consistency**), Доступность (**Availability**) и Устойчивость к разделению (**Partition tolerance**). 

Рассмотрим, к каким системам по CAP-теореме относятся некоторые популярные БД.

### MongoDB
**Тип системы: CP (Consistency и Partition tolerance)**
* MongoDB ориентирована на согласованность данных. В распределённой системе она гарантирует, что все узлы видят одни и те же данные в определённый момент времени.
* При возникновении сетевого разделения (Partition tolerance) MongoDB жертвует доступностью, чтобы сохранить согласованность. Это означает, что если происходит разделение, система может стать недоступной для записи или чтения до тех пор, пока разделение не будет устранено.
* MongoDB использует механизм репликации и выборов лидера (leader election) для обеспечения согласованности.

### MSSQL (Microsoft SQL Server)
**Тип системы: CA (Consistency и Availability)**
* MSSQL традиционно является реляционной базой данных, которая ориентирована на согласованность и доступность.
* В распределённых сценариях (например, при использовании AlwaysOn Availability Groups) MSSQL старается поддерживать доступность и согласованность, но при этом может быть уязвима к сетевым разделениям.
* MSSQL не является распределённой системой по умолчанию, поэтому её классификация по CAP-теореме применима только в контексте распределённых конфигураций.

### Cassandra
**Тип системы: AP (Availability и Partition tolerance)**
* Cassandra спроектирована как распределённая NoSQL-база данных, которая отдаёт приоритет доступности и устойчивости к разделению.
* В случае сетевого разделения Cassandra остаётся доступной для чтения и записи, но может временно пожертвовать согласованностью (например, данные на разных узлах могут быть несогласованными до момента синхронизации).
* Cassandra использует механизм eventual consistency (согласованность в конечном счёте), что позволяет ей быть высокодоступной и устойчивой к разделению.

### ClickHouse
**Тип системы: CP (Consistency + Partition Tolerance)**
* ClickHouse — это колоночная СУБД, оптимизированная для аналитических запросов и обработки больших объёмов данных.
* ClickHouse ориентирована на согласованность данных, так как аналитические задачи требуют точности и актуальности информации.
* В распределённых сценариях ClickHouse жертвует доступностью в пользу согласованности и устойчивости к разделению. При сетевом разделении система может стать недоступной для записи или чтения до восстановления соединения.
* ClickHouse использует репликацию для обеспечения отказоустойчивости, но при этом контролирует согласованность данных.

### Redis
**Тип системы: CP (Consistency + Partition Tolerance)**
* Redis — это in-memory key-value хранилище, которое ориентировано на согласованность и устойчивость к разделению.
* В распределённых сценариях (например, при использовании Redis Cluster) система жертвует доступностью в пользу согласованности. При сетевом разделении Redis может стать недоступным для записи или чтения до восстановления соединения.
* Redis использует репликацию и механизмы кворума для обеспечения согласованности данных.

### Neo4j
**Тип системы: CP (Consistency + Partition Tolerance)**
* Neo4j — это графовая база данных, которая ориентирована на согласованность и доступность.
* В распределённых сценариях Neo4j старается поддерживать доступность и согласованность, но при этом может быть уязвима к сетевым разделениям.
* Neo4j не является распределённой системой по умолчанию, поэтому её классификация по CAP-теореме применима только в контексте распределённых конфигураций (например, при использовании Neo4j Causal Clustering).

### Итоговая таблица CAP-классификации

| БД | CAP Классификация  | Обоснование |
|:-----------|:----------:|:----------|
| MongoDB    | CP         |Ориентирована на согласованность и устойчивость к разделению, жертвует доступностью |
| MSSQL      | CA         |Ориентирована на согласованность и доступность, но не на устойчивость к разделению |
| Cassandra  | AP         |Ориентирована на доступность и устойчивость к разделению, жертвует согласованностью |
| ClickHouse | CP         |Ориентирована на согласованность и устойчивость к разделению, жертвует доступностью |
| Redis      | CP         |Ориентирована на согласованность и устойчивость к разделению, жертвует доступностью |
| Neo4j      | CA         |Ориентирована на согласованность и доступность, но не на устойчивость к разделению |

## Теорема PACELC
Теорема PACELC расширяет CAP-теорему, добавляя ещё один аспект: в нормальных условиях (без сетевого разделения) система также делает выбор между латентностью (Latency) и согласованностью (Consistency). Таким образом, PACELC формулируется так:
* При наличии разделения (Partition): система выбирает между доступностью (Availability) и согласованностью (Consistency) (как в CAP).
* В нормальных условиях (Else): система выбирает между латентностью (Latency) и согласованностью (Consistency).

**Рассмотрим классификацию указанных БД с точки зрения PACELC**

### MongoDB
**PACELC-классификация: PC/EC**
* При разделении (P): MongoDB выбирает согласованность (Consistency) и жертвует доступностью (Availability) (PC). В случае сетевого разделения MongoDB блокирует запись или чтение на некоторых узлах, чтобы обеспечить согласованность данных.
* В нормальных условиях (E): MongoDB отадёт приоритет согласованности (Consistency) и может жертвовать латентностью (Latency) (EC). Это связано с тем, что MongoDB использует механизмы репликации и выборов лидера (leader election), которые могут увеличивать задержки для обеспечения согласованности данных.

### MSSQL (Microsoft SQL Server)
**PACELC-классификация: CA/EC**
* При разделении (P): MSSQL выбирает согласованность (Consistency) и доступность (Availability) (CA). В распределённых сценариях (например, при использовании AlwaysOn Availability Groups) MSSQL старается поддерживать доступность и согласованность, но при этом может быть уязвима к сетевым разделениям. В некоторых случаях MSSQL может жертвовать доступностью для обеспечения согласованности.
* В нормальных условиях (E): MSSQL выбирает согласованность (Consistency) и может жертвовать латентностью (Latency) (EC). Это связано с тем, что MSSQL, как реляционная база данных, ориентирована на точность и актуальность данных, что может увеличивать задержки при выполнении транзакций.

### Cassandra
**PACELC-классификация: PA/EL**
* При разделении (P): Cassandra выбирает доступность (Availability) и жертвует согласованностью (Consistency) (PA). В случае сетевого разделения Cassandra остаётся доступной для чтения и записи, но данные на разных узлах могут быть временно несогласованными.
* В нормальных условиях (E): Cassandra выбирает латентность (Latency) и жертвует согласованностью (Consistency) (EL). Cassandra использует механизм eventual consistency (согласованность в конечном счёте), что позволяет ей быть высокодоступной и быстрой, даже если данные временно не согласованы.

### ClickHouse
**PACELC-классификация: PC/EC**
* При разделении (P): ClickHouse выбирает согласованность (Consistency) и жертвует доступностью (PC).
* В нормальных условиях (E): ClickHouse также выбирает согласованность (Consistency) и может жертвовать латентностью (EC), так как аналитические запросы требуют точности данных.

### Redis
**PACELC-классификация: PC/EC**
* При разделении (P): Redis выбирает согласованность (Consistency) и жертвует доступностью (Availability) (PC). В случае сетевого разделения Redis может стать недоступным для записи или чтения на некоторых узлах, чтобы обеспечить согласованность данных.
* В нормальных условиях (E): Redis выбирает согласованность (Consistency) и может жертвовать латентностью (Latency) (EC). Это связано с тем, что Redis, как in-memory key-value хранилище, ориентировано на точность и актуальность данных.

### Neo4j
**PACELC-классификация: CA/EC**
* При разделении (P): Neo4j выбирает согласованность (Consistency) и доступность (Availability) (CA). В распределённых сценариях (например, при использовании Neo4j Causal Clustering) Neo4j старается поддерживать доступность и согласованность, но при этом может быть уязвима к сетевым разделениям. В некоторых случаях Neo4j может жертвовать доступностью для обеспечения согласованности.
* В нормальных условиях (E): Neo4j выбирает согласованность (Consistency) и может жертвовать латентностью (Latency) (EC). Это связано с тем, что Neo4j, как графовая база данных, ориентирована на точность и актуальность данных.

### Итоговая таблица PACELC-классификации

| БД | PACELC-Классификация  | Обоснование |
|:-----------|:----------:|:----------|
| MongoDB    | PC/EC         |При разделении: согласованность; в нормальных условиях: согласованность |
| MSSQL      | CA/EC         |При разделении: согласованность и доступность; в нормальных условиях: согласованность |
| Cassandra  | PA/EL         |При разделении: доступность; в нормальных условиях: латентность |
| ClickHouse | PC/EC         |При разделении: согласованность; в нормальных условиях: согласованность |
| Redis      | PC/EC         |При разделении: согласованность; в нормальных условиях: согласованность |
| Neo4j      | CA/EC         |При разделении: согласованность и доступность; в нормальных условиях: согласованность|

